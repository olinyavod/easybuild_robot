# ะะพะบัะผะตะฝัะฐัะธั: ะคะธะปัััะฐัะธั ะฟัะพะตะบัะพะฒ ะฟะพ ะณััะฟะฟะฐะผ ะฒ ะบะพะผะฐะฝะดะต /build

## ะะฐัะฐ: 9 ะฝะพัะฑัั 2025

## ะะฟะธัะฐะฝะธะต ััะฝะบัะธะพะฝะฐะปะฐ

ะะพะผะฐะฝะดะฐ `/build` ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะธะปััััะตั ัะฟะธัะพะบ ะฟัะพะตะบัะพะฒ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะบะพะฝัะตะบััะฐ ะฒัะทะพะฒะฐ:

- **ะ ะณััะฟะฟะต** โ ะฟะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ะฟัะพะตะบัั, ัะพะฟะพััะฐะฒะปะตะฝะฝัะต ั ััะพะน ะณััะฟะฟะพะน
- **ะ ะปะธัะฝะพะผ ัะฐัะต** โ ะฟะพะบะฐะทัะฒะฐะตั ะฒัะต ะฟัะพะตะบัั

## ะะตะฐะปะธะทะฐัะธั

### 1. BuildCommand - ะพัะฝะพะฒะฝะฐั ะปะพะณะธะบะฐ

**ะคะฐะนะป:** `python/src/easybuild_bot/commands/implementations/build_command.py`

```python
async def execute(self, ctx: CommandContext) -> CommandResult:
    """Execute build command - show projects based on context."""
    chat = ctx.update.effective_chat
    
    # Get projects based on context
    if chat and chat.type in ("group", "supergroup"):
        # In groups, show only projects available for this group
        projects = self.storage.get_projects_for_group(chat.id)
        context_msg = "ะดะปั ััะพะน ะณััะฟะฟั"
    else:
        # In private chat, show all projects
        projects = self.storage.get_all_projects()
        context_msg = "ะฒัะต ะดะพัััะฟะฝัะต"
```

**ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั:**
- ะะฟัะตะดะตะปัะตััั ัะธะฟ ัะฐัะฐ (ะณััะฟะฟะฐ ะธะปะธ ะปะธัะฝัะน)
- ะะปั ะณััะฟะฟ ะฒัะทัะฒะฐะตััั `get_projects_for_group(chat.id)`
- ะะปั ะปะธัะฝะพะณะพ ัะฐัะฐ ะฒัะทัะฒะฐะตััั `get_all_projects()`

### 2. Storage.get_projects_for_group - ัะธะปัััะฐัะธั

**ะคะฐะนะป:** `python/src/easybuild_bot/storage.py`

```python
def get_projects_for_group(self, group_id: int) -> List[Project]:
    """
    Get all projects available for a specific group.
    
    Args:
        group_id: Telegram group ID
        
    Returns:
        List of projects available for the group
    """
    projects = self._db["projects"]
    result: List[Project] = []
    for doc in projects.find({}):
        allowed_groups = doc.get("allowed_group_ids", [])
        # If no groups specified, project is available for all groups
        if not allowed_groups or group_id in allowed_groups:
            result.append(self._doc_to_project(doc))
    return result
```

**ะะพะณะธะบะฐ ัะธะปัััะฐัะธะธ:**
1. ะะพะปััะฐะตั ะฒัะต ะฟัะพะตะบัั ะธะท ะะ
2. ะะปั ะบะฐะถะดะพะณะพ ะฟัะพะตะบัะฐ ะฟัะพะฒะตััะตั `allowed_group_ids`
3. ะัะปะธ ัะฟะธัะพะบ ะฟัััะพะน (`[]`) โ ะฟัะพะตะบั ะดะพัััะฟะตะฝ ะดะปั ะฒัะตั ะณััะฟะฟ
4. ะัะปะธ `group_id` ะตััั ะฒ ัะฟะธัะบะต โ ะฟัะพะตะบั ะดะพัััะฟะตะฝ ะดะปั ััะพะน ะณััะฟะฟั
5. ะะพะทะฒัะฐัะฐะตั ัะพะปัะบะพ ะฟะพะดัะพะดััะธะต ะฟัะพะตะบัั

### 3. ProjectSelectCallbackCommand - ะดะพะฟะพะปะฝะธัะตะปัะฝะฐั ะฟัะพะฒะตัะบะฐ

**ะคะฐะนะป:** `python/src/easybuild_bot/commands/implementations/project_select_callback.py`

```python
async def can_execute(self, ctx: CommandContext) -> tuple[bool, Optional[str]]:
    """Check if user has access and if project is allowed for the group."""
    # First check user access
    has_access, error_msg = await self._check_user_access(ctx.update, require_admin=False)
    if not has_access:
        return has_access, error_msg
    
    # Check if project is allowed for the group (if called from group)
    query = ctx.update.callback_query
    if query and query.data:
        parts = query.data.split(":", 1)
        if len(parts) == 2:
            project_id = parts[1]
            project = self.storage.get_project_by_id(project_id)
            
            # Check if called from group
            chat = ctx.update.effective_chat
            if chat and chat.type in ("group", "supergroup"):
                # Verify project is allowed for this group
                if project and chat.id not in project.allowed_group_ids:
                    return False, "ะญัะพั ะฟัะพะตะบั ะฝะตะดะพัััะฟะตะฝ ะดะปั ะดะฐะฝะฝะพะน ะณััะฟะฟั"
    
    return True, None
```

**ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะทะฐัะธัะฐ:**
- ะัะธ ะฒัะฑะพัะต ะฟัะพะตะบัะฐ ะธะท ะบะฝะพะฟะบะธ ะฟัะพะฒะตััะตััั ะดะพัััะฟ ะบ ะฟัะพะตะบัั
- ะัะปะธ ะฟัะพะตะบั ะฝะตะดะพัััะฟะตะฝ ะดะปั ะณััะฟะฟั โ ะฟะพะบะฐะทัะฒะฐะตััั ะพัะธะฑะบะฐ
- ะญัะพ ะทะฐัะธัะฐ ะพั ะฟะพะฟััะพะบ ะพะฑัะพะดะฐ ัะตัะตะท ะฟััะผัะต callback'ะธ

## ะะพะดะตะปั ะฟัะพะตะบัะฐ

```python
@dataclass
class Project:
    id: str
    name: str
    # ...
    allowed_group_ids: List[int] = field(default_factory=list)
```

**ะะฝะฐัะตะฝะธั `allowed_group_ids`:**
- `[]` (ะฟัััะพะน ัะฟะธัะพะบ) โ ะฟัะพะตะบั ะดะพัััะฟะตะฝ ะดะปั **ะฒัะตั ะณััะฟะฟ**
- `[group_id]` โ ะฟัะพะตะบั ะดะพัััะฟะตะฝ ัะพะปัะบะพ ะดะปั ัะบะฐะทะฐะฝะฝะพะน ะณััะฟะฟั
- `[group_id1, group_id2, ...]` โ ะฟัะพะตะบั ะดะพัััะฟะตะฝ ะดะปั ะฝะตัะบะพะปัะบะธั ะณััะฟะฟ (ัะพัั ะฟะพ ะฑะธะทะฝะตั-ะปะพะณะธะบะต ะธัะฟะพะปัะทัะตััั ะพะดะฝะฐ ะณััะฟะฟะฐ)

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัะพะตะบั ะดะปั ะบะพะฝะบัะตัะฝะพะน ะณััะฟะฟั

**ะะฐัััะพะนะบะฐ ะฟัะพะตะบัะฐ:**
```python
Project(
    id="project1",
    name="MyApp",
    allowed_group_ids=[-1001234567890]  # ะขะพะปัะบะพ ะดะปั ะณััะฟะฟั ั ID -1001234567890
)
```

**ะะตะทัะปััะฐั:**
- ะ ะณััะฟะฟะต `-1001234567890`: `/build` โ ะฟะพะบะฐะทัะฒะฐะตั "MyApp"
- ะ ะดััะณะพะน ะณััะฟะฟะต: `/build` โ ะฝะต ะฟะพะบะฐะทัะฒะฐะตั "MyApp"
- ะ ะปะธัะฝะพะผ ัะฐัะต: `/build` โ ะฟะพะบะฐะทัะฒะฐะตั "MyApp" (ะธ ะฒัะต ะดััะณะธะต ะฟัะพะตะบัั)

### ะัะธะผะตั 2: ะัะพะตะบั ะดะปั ะฒัะตั ะณััะฟะฟ

**ะะฐัััะพะนะบะฐ ะฟัะพะตะบัะฐ:**
```python
Project(
    id="project2",
    name="PublicApp",
    allowed_group_ids=[]  # ะะปั ะฒัะตั ะณััะฟะฟ
)
```

**ะะตะทัะปััะฐั:**
- ะ ะปัะฑะพะน ะณััะฟะฟะต: `/build` โ ะฟะพะบะฐะทัะฒะฐะตั "PublicApp"
- ะ ะปะธัะฝะพะผ ัะฐัะต: `/build` โ ะฟะพะบะฐะทัะฒะฐะตั "PublicApp"

## ะะฐัััะพะนะบะฐ ะฟัะพะตะบัะพะฒ

ะงัะพะฑั ัะพะฟะพััะฐะฒะธัั ะฟัะพะตะบั ั ะณััะฟะฟะพะน, ะธัะฟะพะปัะทัะนัะต ะบะพะผะฐะฝะดั `/edit_project`:

1. `/edit_project` โ ะฒัะฑะพั ะฟัะพะตะบัะฐ
2. ะัะฑัะฐัั ะฟะพะปะต "๐ฅ ะััะฟะฟั"
3. ะัะฑัะฐัั ะฝัะถะฝัั ะณััะฟะฟั ะธะท ัะฟะธัะบะฐ
4. ะกะพััะฐะฝะธัั ะธะทะผะตะฝะตะฝะธั

ะะพัะปะต ััะพะณะพ ะฟัะพะตะบั ะฑัะดะตั ะดะพัััะฟะตะฝ ัะพะปัะบะพ ะฒ ะฒัะฑัะฐะฝะฝะพะน ะณััะฟะฟะต.

## ะฃะฟัะฐะฒะปะตะฝะธะต ะณััะฟะฟะฐะผะธ

### ะะตะณะธัััะฐัะธั ะณััะฟะฟั

1. ะ ะณััะฟะฟะต ะฒัะฟะพะปะฝะธัะต: `/register_group`
2. ะััะฟะฟะฐ ะฑัะดะตั ะทะฐัะตะณะธัััะธัะพะฒะฐะฝะฐ ะฒ ัะธััะตะผะต
3. ะขะตะฟะตัั ััั ะณััะฟะฟั ะผะพะถะฝะพ ะฒัะฑัะฐัั ะฟัะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะธ ะฟัะพะตะบัะฐ

### ะัะพัะผะพัั ะทะฐัะตะณะธัััะธัะพะฒะฐะฝะฝัั ะณััะฟะฟ

- `/groups` (ะฐะดะผะธะฝ) โ ัะฟะธัะพะบ ะฒัะตั ะทะฐัะตะณะธัััะธัะพะฒะฐะฝะฝัั ะณััะฟะฟ

## ะะธะฐะณัะฐะผะผะฐ ัะฐะฑะพัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ะะพะผะฐะฝะดะฐ /build                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโโ
                    โ  ะะฟัะตะดะตะปะธัั ัะธะฟ  โ
                    โ      ัะฐัะฐ        โ
                    โโโโโโโโโโโโโโโโโโโโ
                              โ
                โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ
                โ                           โ
                โผ                           โผ
        โโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโ
        โ    ะััะฟะฟะฐ    โ          โ ะะธัะฝัะน ัะฐั   โ
        โโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโ
                โ                           โ
                โผ                           โผ
    get_projects_for_group(id)    get_all_projects()
                โ                           โ
                โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโโ
                    โ  ะัะพะฑัะฐะทะธัั      โ
                    โ  ัะฟะธัะพะบ ะฟัะพะตะบัะพะฒ โ
                    โโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโโ
                    โ ะะพะปัะทะพะฒะฐัะตะปั     โ
                    โ ะฒัะฑะธัะฐะตั ะฟัะพะตะบั  โ
                    โโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโโ
                    โ ะัะพะฒะตัะบะฐ ะดะพัััะฟะฐ โ
                    โ (can_execute)    โ
                    โโโโโโโโโโโโโโโโโโโโ
                              โ
                โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ
                โ                           โ
                โผ                           โผ
            โ ะะพัััะฟะตะฝ                  โ ะะตะดะพัััะฟะตะฝ
                โ                           โ
                โผ                           โผ
        ะะฐัะฐะปะพ ัะฑะพัะบะธ              ะะพะบะฐะท ะพัะธะฑะบะธ
```

## ะะตะทะพะฟะฐัะฝะพััั

**ะะฝะพะณะพััะพะฒะฝะตะฒะฐั ะทะฐัะธัะฐ:**

1. **ะฃัะพะฒะตะฝั 1:** ะะพะผะฐะฝะดะฐ `/build` ะฟะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ะดะพัััะฟะฝัะต ะฟัะพะตะบัั
2. **ะฃัะพะฒะตะฝั 2:** Callback-ะพะฑัะฐะฑะพััะธะบ ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ะฟัะพะฒะตััะตั ะดะพัััะฟ
3. **ะะตะทัะปััะฐั:** ะะตะฒะพะทะผะพะถะฝะพ ะทะฐะฟัััะธัั ัะฑะพัะบั ะฝะตะดะพัััะฟะฝะพะณะพ ะฟัะพะตะบัะฐ

## ะะฐััะพะฝัััะต ะบะพะผะฐะฝะดั

ะะฝะฐะปะพะณะธัะฝะฐั ะปะพะณะธะบะฐ ะธัะฟะพะปัะทัะตััั ะฒ:
- `/build` โ ัะฑะพัะบะฐ ะฟัะพะตะบัะพะฒ
- `/projects` โ ะฟัะพัะผะพัั ัะฟะธัะบะฐ ะฟัะพะตะบัะพะฒ

## ะขะตััะธัะพะฒะฐะฝะธะต

### ะกัะตะฝะฐัะธะน 1: ะััะฟะฟะฐ ั ะฟัะพะตะบัะฐะผะธ
1. ะะฐัะตะณะธัััะธััะนัะต ะณััะฟะฟั: `/register_group`
2. ะกะพะทะดะฐะนัะต ะฟัะพะตะบั ะธ ะฟัะธะฒัะถะธัะต ะบ ััะพะน ะณััะฟะฟะต
3. ะ ะณััะฟะฟะต ะฒัะฟะพะปะฝะธัะต: `/build`
4. โ ะะพะปะถะตะฝ ะฟะพะบะฐะทะฐัััั ัะพะปัะบะพ ะฟัะธะฒัะทะฐะฝะฝัะน ะฟัะพะตะบั

### ะกัะตะฝะฐัะธะน 2: ะััะฟะฟะฐ ะฑะตะท ะฟัะพะตะบัะพะฒ
1. ะ ะณััะฟะฟะต ะฑะตะท ะฟัะธะฒัะทะฐะฝะฝัั ะฟัะพะตะบัะพะฒ: `/build`
2. โ ะกะพะพะฑัะตะฝะธะต: "ะะตั ะดะพัััะฟะฝัั ะฟัะพะตะบัะพะฒ ะดะปั ัะฑะพัะบะธ (ะดะปั ััะพะน ะณััะฟะฟั)"

### ะกัะตะฝะฐัะธะน 3: ะะธัะฝัะน ัะฐั
1. ะ ะปะธัะฝะพะผ ัะฐัะต: `/build`
2. โ ะะพะปะถะฝั ะฟะพะบะฐะทะฐัััั ะฒัะต ะฟัะพะตะบัั

### ะกัะตะฝะฐัะธะน 4: ะะพะฟััะบะฐ ะพะฑัะพะดะฐ
1. ะะท ะณััะฟะฟั A ะฟะพะฟััะฐัััั ะทะฐะฟัััะธัั ะฟัะพะตะบั, ะดะพัััะฟะฝัะน ัะพะปัะบะพ ะดะปั ะณััะฟะฟั B
2. โ ะัะธะฑะบะฐ: "ะญัะพั ะฟัะพะตะบั ะฝะตะดะพัััะฟะตะฝ ะดะปั ะดะฐะฝะฝะพะน ะณััะฟะฟั"

## ะัะตะธะผััะตััะฒะฐ

1. **ะะทะพะปััะธั:** ะัะพะตะบัั ะพะดะฝะพะน ะณััะฟะฟั ะฝะต ะฒะธะดะฝั ะฒ ะดััะณะธั ะณััะฟะฟะฐั
2. **ะะธะฑะบะพััั:** ะะพะถะฝะพ ะฝะฐัััะพะธัั ะดะพัััะฟ ะดะปั ะบะฐะถะดะพะณะพ ะฟัะพะตะบัะฐ
3. **ะะตะทะพะฟะฐัะฝะพััั:** ะะตะฒะพะทะผะพะถะฝะพ ะทะฐะฟัััะธัั ะฝะตะดะพัััะฟะฝัะน ะฟัะพะตะบั
4. **ะฃะดะพะฑััะฒะพ:** ะะพะปัะทะพะฒะฐัะตะปะธ ะฒะธะดัั ัะพะปัะบะพ ัะตะปะตะฒะฐะฝัะฝัะต ะฟัะพะตะบัั
5. **ะฃะฝะธะฒะตััะฐะปัะฝะพััั:** ะ ะปะธัะฝะพะผ ัะฐัะต ะดะพัััะฟะฝั ะฒัะต ะฟัะพะตะบัั

## ะกัะฐััั

โ **ะคัะฝะบัะธะพะฝะฐะป ะฟะพะปะฝะพัััั ัะตะฐะปะธะทะพะฒะฐะฝ ะธ ัะฐะฑะพัะฐะตั**
- ะคะธะปัััะฐัะธั ะฟะพ ะณััะฟะฟะฐะผ: โ
- ะคะธะปัััะฐัะธั ะฒ ะปะธัะฝะพะผ ัะฐัะต: โ
- ะัะพะฒะตัะบะฐ ะดะพัััะฟะฐ: โ
- UI ัะพะพะฑัะตะฝะธั: โ

ะะธะบะฐะบะธั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะธะทะผะตะฝะตะฝะธะน ะฝะต ััะตะฑัะตััั!


