# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: MarkdownV2 –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–∫–æ–±–æ–∫ –≤ show_group_selection

## –î–∞—Ç–∞: 9 –Ω–æ—è–±—Ä—è 2025

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π:

```
telegram.error.BadRequest: Can't parse entities: character '(' is reserved and must be escaped with the preceding '\'
```

## –ü—Ä–∏—á–∏–Ω–∞

–í Telegram MarkdownV2 –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏ `(` –∏ `)` —è–≤–ª—è—é—Ç—Å—è **–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏** –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –æ–±—Ä–∞—Ç–Ω—ã–º —Å–ª—ç—à–µ–º `\`.

–í –º–µ—Ç–æ–¥–µ `show_group_selection` (—Å—Ç—Ä–æ–∫–∞ 373) –±—ã–ª —Ç–µ–∫—Å—Ç —Å –Ω–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏:

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Å–∫–æ–±–∫–∏ –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
f"_(—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç –ø–æ –±–∏–∑–Ω–µ—Å\\-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)_"
```

## –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ MarkdownV2

–í MarkdownV2 —Å–ª–µ–¥—É—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã:

```
_ * [ ] ( ) ~ ` > # + - = | { } . !
```

–î–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–π —Å–ª—ç—à: `\`

## –†–µ—à–µ–Ω–∏–µ

–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–∫–æ–±–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
f"_\\(—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç –ø–æ –±–∏–∑–Ω–µ—Å\\-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\\)_"
```

### –ü–æ—á–µ–º—É –¥–≤–æ–π–Ω–æ–π —Å–ª—ç—à `\\`?

–í Python —Å—Ç—Ä–æ–∫–∞—Ö –æ–±—Ä–∞—Ç–Ω—ã–π —Å–ª—ç—à `\` —è–≤–ª—è–µ—Ç—Å—è escape-—Å–∏–º–≤–æ–ª–æ–º, –ø–æ—ç—Ç–æ–º—É:
- `\(` –≤ Python-—Å—Ç—Ä–æ–∫–µ ‚Üí `(` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ (–Ω–µ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ)
- `\\(` –≤ Python-—Å—Ç—Ä–æ–∫–µ ‚Üí `\(` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è MarkdownV2)

## –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

- `python/src/easybuild_bot/handlers/edit_project_wizard.py` ‚Äî –º–µ—Ç–æ–¥ `show_group_selection`, —Å—Ç—Ä–æ–∫–∞ 373

## –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –î–æ:
```python
msg = (
    f"üë• *–í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞*\n\n"
    f"üì¶ *–ü—Ä–æ–µ–∫—Ç:* `{escape_md(project.name)}`\n"
    f"*–¢–µ–∫—É—â–∞—è –≥—Ä—É–ø–ø–∞:* {current_value_text}\n\n"
    f"üí° –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–æ–µ–∫—Ç:\n"
    f"_(—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç –ø–æ –±–∏–∑–Ω–µ—Å\\-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)_"  # ‚ùå –°–∫–æ–±–∫–∏ –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
)
```

### –ü–æ—Å–ª–µ:
```python
msg = (
    f"üë• *–í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞*\n\n"
    f"üì¶ *–ü—Ä–æ–µ–∫—Ç:* `{escape_md(project.name)}`\n"
    f"*–¢–µ–∫—É—â–∞—è –≥—Ä—É–ø–ø–∞:* {current_value_text}\n\n"
    f"üí° –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–æ–µ–∫—Ç:\n"
    f"_\\(—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç –ø–æ –±–∏–∑–Ω–µ—Å\\-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º\\)_"  # ‚úÖ –°–∫–æ–±–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
)
```

## –°—Ç–µ–∫—Ç—Ä–µ–π—Å –æ—à–∏–±–∫–∏

```
Traceback (most recent call last):
  File ".../telegram/ext/_application.py", line 1335, in process_update
    await coroutine
  File ".../telegram/ext/_handlers/conversationhandler.py", line 857, in handle_update
    new_state: object = await handler.handle_update(
  File ".../telegram/ext/_handlers/basehandler.py", line 158, in handle_update
    return await self.callback(update, context)
  File ".../handlers/edit_project_wizard.py", line 289, in select_field
    return await self.show_group_selection(update, context)
  File ".../handlers/edit_project_wizard.py", line 376, in show_group_selection
    await query.message.edit_text(msg, parse_mode="MarkdownV2", reply_markup=reply_markup)
  ...
telegram.error.BadRequest: Can't parse entities: character '(' is reserved and must be escaped with the preceding '\'
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. ‚úÖ `/edit_project` ‚Üí –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
2. ‚úÖ –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –ú–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. ‚úÖ –í—ã–±–æ—Ä –ø–æ–ª—è "–ì—Ä—É–ø–ø—ã" ‚Üí –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ –¢–µ–∫—Å—Ç —Å –∫—É—Ä—Å–∏–≤–æ–º –∏ —Å–∫–æ–±–∫–∞–º–∏ –ø–∞—Ä—Å–∏—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. ‚úÖ –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã ‚Üí –†–∞–±–æ—Ç–∞–µ—Ç

## –£—Ä–æ–∫–∏

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Telegram MarkdownV2:

1. **–í—Å–µ–≥–¥–∞ —ç–∫—Ä–∞–Ω–∏—Ä—É–π—Ç–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã**: `_ * [ ] ( ) ~ ` > # + - = | { } . !`
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `escape_md()`** –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å MarkdownV2** –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
4. **–î–≤–æ–π–Ω–æ–π —Å–ª—ç—à –≤ Python**: `\\(` ‚Üí `\(` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `escape_md()` –¥–ª—è –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞:

```python
# –í–∞—Ä–∏–∞–Ω—Ç —Å escape_md
text_to_escape = "(—Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç –ø–æ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)"
msg = f"_{escape_md(text_to_escape)}_"
```

–ù–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—â–µ –≤—Ä—É—á–Ω—É—é —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–≤–µ —Å–∫–æ–±–∫–∏, —á–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

## –°–ø—Ä–∞–≤–∫–∞ –ø–æ MarkdownV2

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:

1. **–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç**: `*bold*` ‚Üí **bold**
2. **–ö—É—Ä—Å–∏–≤**: `_italic_` ‚Üí _italic_
3. **–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π**: `` `code` `` ‚Üí `code`
4. **–°—Å—ã–ª–∫–∞**: `[text](url)` ‚Üí [text](url)

### –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:

–í—Å–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤–Ω–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—â–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã:

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ
"Hello \\(world\\)\\!"  # ‚Üí Hello (world)!
"Price: \\$100"         # ‚Üí Price: $100
"Math: 2\\+2\\=4"       # ‚Üí Math: 2+2=4
```

## –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã

- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: **–ë–∞–≥—Ñ–∏–∫—Å**
- –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å: **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è** (–∫–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞)
- –ó–∞—Ç—Ä–æ–Ω—É—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

## Commit message (–ø—Ä–∏–º–µ—Ä)

```
fix: —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã —Å–∫–æ–±–∫–∏ –≤ MarkdownV2 –≤ show_group_selection

–ü—Ä–æ–±–ª–µ–º–∞: Telegram API –æ—Ç–∫–ª–æ–Ω—è–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑-–∑–∞ –Ω–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∫–æ–±–æ–∫
–ü—Ä–∏—á–∏–Ω–∞: –≤ MarkdownV2 —Å–∏–º–≤–æ–ª—ã () –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ \(\)
–†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ \\( –∏ \\) –≤ —Ç–µ–∫—Å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è
–†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
```


