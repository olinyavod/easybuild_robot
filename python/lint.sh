#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–∞–º–∏

set -e

cd "$(dirname "$0")"

echo "========================================="
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Python –∫–æ–¥–∞"
echo "========================================="

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
if ! command -v ruff &> /dev/null; then
    echo -e "${YELLOW}‚ö†Ô∏è  Ruff –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∫–∞...${NC}"
    pip install -r requirements-dev.txt
fi

echo ""
echo "1Ô∏è‚É£  –ó–∞–ø—É—Å–∫ Ruff –ª–∏–Ω—Ç–µ—Ä–∞..."
if ruff check . ; then
    echo -e "${GREEN}‚úÖ Ruff –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞${NC}"
else
    echo -e "${RED}‚ùå Ruff –Ω–∞—à—ë–ª –ø—Ä–æ–±–ª–µ–º—ã${NC}"
    exit 1
fi

echo ""
echo "2Ô∏è‚É£  –ó–∞–ø—É—Å–∫ Ruff —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞)..."
if ruff format --check . ; then
    echo -e "${GREEN}‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ruff format .${NC}"
    exit 1
fi

echo ""
echo "3Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Å MyPy..."
if mypy src/ ; then
    echo -e "${GREEN}‚úÖ MyPy –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–∞${NC}"
else
    echo -e "${RED}‚ùå MyPy –Ω–∞—à—ë–ª –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏${NC}"
    exit 1
fi

echo ""
echo "========================================="
echo -e "${GREEN}üéâ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!${NC}"
echo "========================================="






