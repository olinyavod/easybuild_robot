# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞ –¥–ª—è Flutter –ø—Ä–æ–µ–∫—Ç–æ–≤

## –î–∞—Ç–∞: 27 –æ–∫—Ç—è–±—Ä—è 2025

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ä–µ–ª–∏–∑–∞ –¥–ª—è Flutter –ø—Ä–æ–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –≤–∫–ª—é—á–∞–µ—Ç:
1. –ú–µ—Ä–¥–∂ –≤–µ—Ç–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –≤–µ—Ç–∫—É —Ä–µ–ª–∏–∑–∞
2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–µ—Ç–∫—É —Ä–µ–ª–∏–∑–∞
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ `pubspec.yaml`
4. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

## Workflow

### 1. –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```
/build ‚Üí –í—ã–±–æ—Ä Flutter –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```

### 2. –ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π

–î–ª—è Flutter –ø—Ä–æ–µ–∫—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞:

```
üéØ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Å–±–æ—Ä–∫–µ v1.0.0

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
[üî® –°–æ–±—Ä–∞—Ç—å Debug]
[üöÄ –°–æ–±—Ä–∞—Ç—å Release]
[üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑]    ‚Üê –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê
[üßπ –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã]
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑":

1. –ë–æ—Ç –ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é:
```
üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ MyApp

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.0.0+1

–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ: version <–≤–µ—Ä—Å–∏—è>
–ù–∞–ø—Ä–∏–º–µ—Ä: version 1.2.3+45
```

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: `version 1.0.1+2`

3. –ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:
```
üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É —Ä–µ–ª–∏–∑–∞ –≤–µ—Ä—Å–∏–∏ 1.0.1+2...
üîÄ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–µ—Ç–∫—É —Ä–µ–ª–∏–∑–∞: main...
‚¨áÔ∏è –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –≤–µ—Ç–∫–∏ —Ä–µ–ª–∏–∑–∞...
üîÑ –ú–µ—Ä–¥–∂ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ develop –≤ main...
‚úÖ –í–µ—Ç–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–º–µ—Ä–¥–∂–µ–Ω—ã
üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ pubspec.yaml –Ω–∞ 1.0.1+2...
‚úÖ –í–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ 1.0.1+2
üíæ –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π...
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã

üéâ –†–µ–ª–∏–∑ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω!

‚úÖ –í–µ—Ç–∫–∞: main
‚úÖ –í–µ—Ä—Å–∏—è: 1.0.1+2
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ develop —Å–º–µ—Ä–¥–∂–µ–Ω—ã

‚ö†Ô∏è –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–¥–µ–ª–∞—Ç—å push:
git push origin main
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### FlutterBuilder.prepare_release()

–ú–µ—Ç–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **Checkout release branch**
   ```bash
   git checkout main
   ```

2. **Pull latest changes**
   ```bash
   git pull origin main
   ```

3. **Merge dev into release**
   ```bash
   git merge develop -m "Merge develop for release 1.0.1+2"
   ```
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `git merge --abort`

4. **Update version in pubspec.yaml**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `FlutterVersionManager.update_version()`
   - Regex –∑–∞–º–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∏ `version: ...`

5. **Commit changes**
   ```bash
   git add pubspec.yaml
   git commit -m "Bump version to 1.0.1+2"
   ```

### FlutterVersionManager

–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `pubspec.yaml`:

```python
class FlutterVersionManager:
    @staticmethod
    def update_version(pubspec_path: str, new_version: str) -> bool:
        """Update version in pubspec.yaml."""
        # Regex: ^version:\s*.*$ ‚Üí version: 1.0.1+2
```

### –ö–æ–º–∞–Ω–¥—ã

#### PrepareReleaseCallbackCommand

- **Pattern:** `build_prepare_release:<project_id>`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç prompt –¥–ª—è –≤–≤–æ–¥–∞ –≤–µ—Ä—Å–∏–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `builder.supports_release_preparation()`

#### ExecuteReleaseCallbackCommand

- **Pattern:** `execute_release:<project_id>:<version>`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –í—ã–ø–æ–ª–Ω—è–µ—Ç `builder.prepare_release(version)`

#### VersionCommand

- **Pattern:** `version <–Ω–æ–º–µ—Ä>`
- **–î–µ–π—Å—Ç–≤–∏–µ:** –†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –≤–µ—Ä—Å–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
- **Regex:** `r"version\s+([0-9]+\.[0-9]+\.[0-9]+(?:\+[0-9]+)?)"`

### –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ProjectBuilder

–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```python
async def supports_release_preparation(self) -> bool:
    """Check if this builder supports release preparation."""
    return False  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

async def prepare_release(self, new_version: str) -> BuildResult:
    """Prepare release (merge, update version, commit)."""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –¥–ª—è —Ç–∏–ø–∞ –ø—Ä–æ–µ–∫—Ç–∞
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤

### Flutter
‚úÖ **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
- Merge develop ‚Üí release
- Update pubspec.yaml
- Commit changes

### .NET MAUI –∏ Xamarin
‚ö†Ô∏è **–ü–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**
- `supports_release_preparation()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False`
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑" –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω—É–∂–Ω–æ:
1. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `supports_release_preparation()` ‚Üí `True`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `prepare_release()` —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º `.csproj`

## –§–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–∏

**Flutter (pubspec.yaml):**
- –§–æ—Ä–º–∞—Ç: `major.minor.patch+build`
- –ü—Ä–∏–º–µ—Ä—ã: `1.0.0`, `1.2.3+45`, `2.0.0-beta+1`

**Regex:** `[0-9]+\.[0-9]+\.[0-9]+(?:\+[0-9]+)?`

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ merge
```
‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–µ—Ä–¥–∂–µ:
CONFLICT (content): Merge conflict in lib/main.dart
Automatic merge failed
```
- Merge –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è: `git merge --abort`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤—Ä—É—á–Ω—É—é

### –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞—è –≤–µ—Ç–∫–∞
```
‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É main:
error: pathspec 'main' did not match any file(s) known to git
```

### –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–∏
```
‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: version <–Ω–æ–º–µ—Ä>
–ü—Ä–∏–º–µ—Ä: version 1.2.3+45
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Timeout'—ã –¥–ª—è git –æ–ø–µ—Ä–∞—Ü–∏–π (30-120 —Å–µ–∫)
- ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (merge --abort)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –≤–µ—Ä—Å–∏–∏
- ‚ö†Ô∏è **Push –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –≤—Ä—É—á–Ω—É—é

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π push –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ git tag –¥–ª—è —Ä–µ–ª–∏–∑–∞
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π changelog
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è .NET MAUI –∏ Xamarin
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ unit-—Ç–µ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD
- [ ] Rollback —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –£—Å–ø–µ—à–Ω—ã–π —Ñ–ª–æ—É
```
1. /build
2. –í—ã–±—Ä–∞—Ç—å Flutter –ø—Ä–æ–µ–∫—Ç
3. –ù–∞–∂–∞—Ç—å "üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑"
4. –í–≤–µ—Å—Ç–∏: version 1.0.1+2
5. –î–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
6. –í—ã–ø–æ–ª–Ω–∏—Ç—å: git push origin main
```

### –° –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏
```
1. /build
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
3. "üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑"
4. version 2.0.0
5. ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ –º–µ—Ä–¥–∂–µ
6. –í—Ä—É—á–Ω—É—é: git checkout main, git merge develop
7. –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
8. git commit, git push
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
python/src/easybuild_bot/
‚îú‚îÄ‚îÄ builders/
‚îÇ   ‚îú‚îÄ‚îÄ base.py                              # +prepare_release(), +supports_release_preparation()
‚îÇ   ‚îî‚îÄ‚îÄ flutter_builder.py                   # +FlutterVersionManager, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è prepare_release()
‚îî‚îÄ‚îÄ commands/implementations/
    ‚îú‚îÄ‚îÄ prepare_release_callback.py          # NEW: PrepareReleaseCallbackCommand
    ‚îú‚îÄ‚îÄ version_command.py                   # NEW: VersionCommand
    ‚îî‚îÄ‚îÄ project_select_callback.py           # +–∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑"
```




